# Current Plan: Database migrations and environment separation

- Ensure migrations are tracked and idempotent across environments.
- Keep using `xata_id` in `users` while ignoring other Xata meta columns.
- Apply migrations via:
  - Local: `db/migrate_all.sh <dbname>` (e.g., `dbresumebuilder:main`)
  - CI/Prod: `deploy/dbtool-migrate.sh` (uses `XATA_DATABASE_URL`)
- Maintain `_migrations` table to record applied files and skip re-application.
- Migration files owned by the app:
  - `db/migrations/20251027_users.sql`
  - `db/migrations/20251028_add_stripe.sql`
  - `db/migrations/20251102_0002_ig_media.sql`
  - `db/migrations/20251102_0003_user_settings.sql`
  - `db/migrations/20251102_0004_user_uploads.sql`
  - `db/migrations/20251102_0005_user_drafts.sql`
  - `db/migrations/20251102_0007_oauth_accounts.sql`
  - `db/migrations/20251102_0008_ig_accounts.sql`
  - `db/migrations/20251102_0009_network_contents.sql`

## Next
- Optional: add non-unique indexes on `user_id` for frequently queried tables.
- Optional: FK for `ig_accounts.user_id â†’ users(xata_id)` if we want stricter integrity.
